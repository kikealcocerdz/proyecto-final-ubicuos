<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <title>easySHOP</title>
    <link rel="stylesheet" href="/style.css" />
    <style>
      /* Agrega estilos para el popup */
      .popup {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: white;
        padding: 20px;
        border: 1px solid black;
        display: none;
      }
    </style>
  </head>
  <body>
    <header>
      <a href="/" class="shop-title">easySHOP</a>
    </header>
    <section class="shop-container">
      <h3 style="color: white">LISTA ACTUAL</h3>
      <div class="lista-container" id="product-list">
        <!-- La lista de productos se agregará aquí -->
      </div>
      <div class="lista-container" id="product-list-rest">
        <!-- La lista de productos se agregará aquí -->
      </div>
    </section>
    <footer>
      <div class="shop-actions">
        <a href="useractive.html" class="shop-action-button">
          <img src="./public/continueshop.png" />
        </a>
        <a class="shop-action-button">
          <img src="./public/finish-icon.png" />
        </a>
      </div>
    </footer>

    <!-- Agrega el popup -->
    <div class="popup">
      <div class="popup-content">
        <h4>Product Name</h4>
        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit.</p>
        <p>$5.99 / lb</p>
      </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
      const socket = io(); // Conecta al mismo servidor que el archivo server.html

      const productListContainer = document.getElementById("product-list");
      const productListContainerRest =
        document.getElementById("product-list-rest");

      const popup = document.querySelector(".popup");

      // Función para agregar un producto a la lista en el cliente
      function addProduct(productName) {
        const item = document.createElement("div");
        item.classList.add("lista-placeholder");

        const button = document.createElement("button");
        button.classList.add("product-lista");
        button.onclick = function () {
          // Muestra el popup al hacer clic en un producto
          popup.style.display = "block";
        };

        const img = document.createElement("img");
        img.classList.add("product-image");
        img.src = "https://via.placeholder.com/100";
        img.alt = productName;

        const description = document.createElement("div");
        description.classList.add("product-description");

        const nameParagraph = document.createElement("p");
        nameParagraph.textContent = productName.name;

        const priceContainer = document.createElement("div");
        priceContainer.classList.add("product-price-container");

        const pricePerUnit = document.createElement("p");
        pricePerUnit.textContent = productName.price;

        const totalPrice = document.createElement("p");
        totalPrice.textContent = productName.totalPrice;

        const favimage = document.createElement("img");
        favimage.src = productName.isFavorite
          ? "./public/star-filled.png"
          : "./public/star-unfilled.png";
        favimage.alt = productName.isFavorite;

        priceContainer.appendChild(favimage);
        priceContainer.appendChild(pricePerUnit);
        priceContainer.appendChild(totalPrice);
        description.appendChild(nameParagraph);
        description.appendChild(priceContainer);

        button.appendChild(img);
        button.appendChild(description);
        item.appendChild(button);

        productListContainer.appendChild(item);
      }

      function addProductRest(productName) {
        const item = document.createElement("div");
        item.classList.add("item-lista");
        const img = document.createElement("img");
        img.alt = productName.name;
        img.src = productName.imageUrl;
        img.width = 60;
        img.height = 60;
        item.appendChild(img);
        const p = document.createElement("p");
        p.textContent = productName.name;
        item.appendChild(p);
        productListContainerRest.appendChild(item);
      }

      // Solicitar la lista de productos al servidor cuando se carga la página
      window.onload = function () {
        socket.emit("get product list added");
        console.log("Solicitando lista de productos al servidor...");
        // Manejar la respuesta del servidor con la lista de productos
        socket.on("product list", function (productList) {
          console.log("Lista de productos recibida:", productList);
          // Limpiar la lista actual de productos en el cliente
          productListContainer.innerHTML = "";
          // Agregar cada producto de la lista recibida al cliente
          productList.forEach(function (productName) {
            console.log("Producto recibido:", productName);
            addProductRest(productName);
          });
        });
        socket.on("product list added", function (productListAdded) {
          console.log("Lista de productos recibida por voz:", productListAdded);
          // Limpiar la lista actual de productos en el cliente
          productListContainer.innerHTML = "";
          // Agregar cada producto de la lista recibida al cliente
          productListAdded.forEach(function (productName) {
            console.log("Producto recibido por voz:", productName);
            addProduct(productName);
          });
        });
      };

      // Oculta el popup al hacer clic o tocar en cualquier parte fuera del mismo
      document.addEventListener("click", function (event) {
        if (event.target !== popup) {
          popup.style.display = "none";
        }
      });
    </script>
    <script src="./cart.js"></script>
  </body>
</html>
